/*! Live2D Widget Enhanced (https://github.com/SamuNatsu/live2d-widget-enhanced) */
var l2dwe=function(t){"use strict";function e(t,e,i,o){return new(i||(i=Promise))((function(n,s){function r(t){try{l(o.next(t))}catch(t){s(t)}}function d(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,d)}l((o=o.apply(t,e||[])).next())}))}function i(t){console.log(`%cLive2D%c ${t}`,"background:#389ad5;padding:1px 5px;border-radius:3px;color:#fff","")}function o(t,e,i){if(t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),e-t==1&&i===t)return i;for(;;){const o=Math.floor(Math.random()*(e-t))+t;if(o!==i)return o}}var n;function s(t,i){return e(this,void 0,void 0,(function*(){return new Promise(((e,o)=>{switch(i){case n.Script:{const i=document.createElement("script");i.src=t,i.onload=()=>e(),i.onerror=()=>o(),document.head.appendChild(i)}case n.Style:{const i=document.createElement("link");i.rel="stylesheet",i.href=t,i.onload=()=>e(),i.onerror=()=>o(),document.head.append(i)}}}))}))}"function"==typeof SuppressedError&&SuppressedError,function(t){t[t.Script=0]="Script",t[t.Style=1]="Style"}(n||(n={}));let r=null;function d(t,e,i){var o;if(parseInt(null!==(o=sessionStorage.getItem("waifu-text"))&&void 0!==o?o:Number.MIN_SAFE_INTEGER.toString())>i)return;null!==r&&(clearTimeout(r),r=null);const n=t instanceof Array?(s=t)[Math.floor(Math.random()*s.length)]:t;var s;sessionStorage.setItem("waifu-text",i.toString());const d=document.querySelector("#waifu-tips");d.innerHTML=n,d.classList.add("waifu-tips-active"),r=setTimeout((()=>{sessionStorage.removeItem("waifu-text"),d.classList.remove("waifu-tips-active")}),e)}class l{constructor(t){this.api=t}loadModel(t,o,n){return e(this,void 0,void 0,(function*(){localStorage.setItem("modelId",t.toString()),localStorage.setItem("modelTexturesId",o.toString()),d(n,4e3,10),loadlive2d("live2d",yield this.api.get(t,o)),i(`模型 ${t}-${o} 加载完成`)}))}loadRandModel(){return e(this,void 0,void 0,(function*(){var t;const e=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),i=yield this.api.rand(e);yield this.loadModel(i.model.id,0,i.model.message)}))}loadNextModel(){return e(this,void 0,void 0,(function*(){var t;const e=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),i=yield this.api.switch(e);yield this.loadModel(i.model.id,0,i.model.message)}))}loadRandTexture(){return e(this,void 0,void 0,(function*(){var t,e;const i=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),o=parseInt(null!==(e=localStorage.getItem("modelTexturesId"))&&void 0!==e?e:"0"),n=yield this.api.randTexture(i,o);yield this.loadModel(i,n.textures.id,1!==n.textures.id||1!==i&&0!==o?"我的新衣服好看嘛？":"我还没有其他衣服呢！")}))}loadNextTexture(){return e(this,void 0,void 0,(function*(){var t,e;const i=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),o=parseInt(null!==(e=localStorage.getItem("modelTexturesId"))&&void 0!==e?e:"0"),n=yield this.api.switchTexture(i,o);yield this.loadModel(i,n.textures.id,1!==n.textures.id||1!==i&&0!==o?"我的新衣服好看嘛？":"我还没有其他衣服呢！")}))}}return t.RemoteApi=class{constructor(t){this.apiUrl=t}get(t,e){return`${this.apiUrl}/get/?id=${t}-${e}`}rand(t){return e(this,void 0,void 0,(function*(){return fetch(`${this.apiUrl}/rand?id=${t}`).then((t=>t.json()))}))}switch(t){return e(this,void 0,void 0,(function*(){return fetch(`${this.apiUrl}/switch?id=${t}`).then((t=>t.json()))}))}randTexture(t,i){return e(this,void 0,void 0,(function*(){return fetch(`${this.apiUrl}/rand_textures?id=${t}-${i}`).then((t=>t.json()))}))}switchTexture(t,i){return e(this,void 0,void 0,(function*(){return fetch(`${this.apiUrl}/switch_textures?id=${t}-${i}`).then((t=>t.json()))}))}},t.RemoteCdn=class{constructor(t){this.cdnUrl=t}loadModelList(){return e(this,void 0,void 0,(function*(){if(void 0===this.modelList){const t=yield fetch(`${this.cdnUrl}/model_list.json`);this.modelList=yield t.json()}}))}get(t,i){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=this.modelList.models[t]instanceof Array?this.modelList.models[t][i]:this.modelList.models[t];return`${this.cdnUrl}/model/${e}/index.json`}))}rand(t){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=o(0,this.modelList.models.length,t);return{model:{id:e,message:this.modelList.messages[e]}}}))}switch(t){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=(t+1)%this.modelList.models.length;return{model:{id:e,message:this.modelList.messages[e]}}}))}randTexture(t,i){return e(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[t]instanceof Array?o(0,this.modelList.models[t].length,i):0}}}))}switchTexture(t,i){return e(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[t]instanceof Array?(i+1)%this.modelList.models[t].length:0}}}))}},t.init=function(t){return e(this,void 0,void 0,(function*(){const e=(()=>{if(void 0!==t.resource)return t.resource;const e=document.currentScript.src;return e.substring(0,e.lastIndexOf("/"))})();yield Promise.all([s(e+"/live2d.min.js",n.Script),s(e+"/waifu.css",n.Style)]),new l(t.api),console.log("\nく__,.ヘヽ.        /  ,ー､ 〉\n          ＼ ', !-─‐-i  /  /´\n          ／｀ｰ'       L/／｀ヽ､\n        /   ／,   /|   ,   ,       ',\n      ｲ   / /-‐/  ｉ  L_ ﾊ ヽ!   i\n      ﾚ ﾍ 7ｲ｀ﾄ   ﾚ'ｧ-ﾄ､!ハ|   |\n        !,/7 '0'     ´0iソ|    |\n        |.从\"    _     ,,,, / |./    |\n        ﾚ'| i＞.､,,__  _,.イ /   .i   |\n          ﾚ'| | / k_７_/ﾚ'ヽ,  ﾊ.  |\n            | |/i 〈|/   i  ,.ﾍ |  i  |\n            .|/ /  ｉ：    ﾍ!    ＼  |\n            kヽ>､ﾊ    _,.ﾍ､    /､!\n            !'〈//｀Ｔ´', ＼ ｀'7'ｰr'\n            ﾚ'ヽL__|___i,___,ンﾚ|ノ\n                ﾄ-,/  |___./\n                'ｰ'    !_,.:\n加强版 Live2D 看板娘组件 | Live2D Widget Enhanced"),i("Version: 0.1.0"),i("Github: https://github.com/SamuNatsu/live2d-widget-enhanced")}))},t.showMsg=d,t}({});
