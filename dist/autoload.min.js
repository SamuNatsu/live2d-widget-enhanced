/*! Live2D Widget Enhanced (https://github.com/SamuNatsu/live2d-widget-enhanced) */
!function(){"use strict";function t(t,e,i,o){return new(i||(i=Promise))((function(n,s){function d(t){try{l(o.next(t))}catch(t){s(t)}}function r(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(d,r)}l((o=o.apply(t,e||[])).next())}))}function e(t){console.log(`%cLive2D%c ${t}`,"background:#389ad5;padding:1px 5px;border-radius:3px;color:#fff","")}function i(t,e,i){if(t=Math.floor(t),e=Math.floor(e),i=Math.floor(i),e-t==1&&i===t)return i;for(;;){const o=Math.floor(Math.random()*(e-t))+t;if(o!==i)return o}}var o;function n(e,i){return t(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{switch(i){case o.Script:{const i=document.createElement("script");i.src=e,i.onload=()=>t(),i.onerror=()=>n(),document.head.appendChild(i)}case o.Style:{const i=document.createElement("link");i.rel="stylesheet",i.href=e,i.onload=()=>t(),i.onerror=()=>n(),document.head.append(i)}}}))}))}"function"==typeof SuppressedError&&SuppressedError,function(t){t[t.Script=0]="Script",t[t.Style=1]="Style"}(o||(o={}));let s=null;function d(t,e,i){var o;if(parseInt(null!==(o=sessionStorage.getItem("waifu-text"))&&void 0!==o?o:Number.MIN_SAFE_INTEGER.toString())>i)return;null!==s&&(clearTimeout(s),s=null);const n=t instanceof Array?(d=t)[Math.floor(Math.random()*d.length)]:t;var d;sessionStorage.setItem("waifu-text",i.toString());const r=document.querySelector("#waifu-tips");r.innerHTML=n,r.classList.add("waifu-tips-active"),s=setTimeout((()=>{sessionStorage.removeItem("waifu-text"),r.classList.remove("waifu-tips-active")}),e)}class r{constructor(t){this.api=t}loadModel(i,o,n){return t(this,void 0,void 0,(function*(){localStorage.setItem("modelId",i.toString()),localStorage.setItem("modelTexturesId",o.toString()),d(n,4e3,10),loadlive2d("live2d",yield this.api.get(i,o)),e(`模型 ${i}-${o} 加载完成`)}))}loadRandModel(){return t(this,void 0,void 0,(function*(){var t;const e=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),i=yield this.api.rand(e);yield this.loadModel(i.model.id,0,i.model.message)}))}loadNextModel(){return t(this,void 0,void 0,(function*(){var t;const e=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),i=yield this.api.switch(e);yield this.loadModel(i.model.id,0,i.model.message)}))}loadRandTexture(){return t(this,void 0,void 0,(function*(){var t,e;const i=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),o=parseInt(null!==(e=localStorage.getItem("modelTexturesId"))&&void 0!==e?e:"0"),n=yield this.api.randTexture(i,o);yield this.loadModel(i,n.textures.id,1!==n.textures.id||1!==i&&0!==o?"我的新衣服好看嘛？":"我还没有其他衣服呢！")}))}loadNextTexture(){return t(this,void 0,void 0,(function*(){var t,e;const i=parseInt(null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:"1"),o=parseInt(null!==(e=localStorage.getItem("modelTexturesId"))&&void 0!==e?e:"0"),n=yield this.api.switchTexture(i,o);yield this.loadModel(i,n.textures.id,1!==n.textures.id||1!==i&&0!==o?"我的新衣服好看嘛？":"我还没有其他衣服呢！")}))}}!function(i){t(this,void 0,void 0,(function*(){const t=(()=>{if(void 0!==i.resource)return i.resource;const t=document.currentScript.src;return t.substring(0,t.lastIndexOf("/"))})();yield Promise.all([n(t+"/live2d.min.js",o.Script),n(t+"/waifu.css",o.Style)]),new r(i.api),console.log("\nく__,.ヘヽ.        /  ,ー､ 〉\n          ＼ ', !-─‐-i  /  /´\n          ／｀ｰ'       L/／｀ヽ､\n        /   ／,   /|   ,   ,       ',\n      ｲ   / /-‐/  ｉ  L_ ﾊ ヽ!   i\n      ﾚ ﾍ 7ｲ｀ﾄ   ﾚ'ｧ-ﾄ､!ハ|   |\n        !,/7 '0'     ´0iソ|    |\n        |.从\"    _     ,,,, / |./    |\n        ﾚ'| i＞.､,,__  _,.イ /   .i   |\n          ﾚ'| | / k_７_/ﾚ'ヽ,  ﾊ.  |\n            | |/i 〈|/   i  ,.ﾍ |  i  |\n            .|/ /  ｉ：    ﾍ!    ＼  |\n            kヽ>､ﾊ    _,.ﾍ､    /､!\n            !'〈//｀Ｔ´', ＼ ｀'7'ｰr'\n            ﾚ'ヽL__|___i,___,ンﾚ|ノ\n                ﾄ-,/  |___./\n                'ｰ'    !_,.:\n加强版 Live2D 看板娘组件 | Live2D Widget Enhanced"),e("Version: 0.1.0"),e("Github: https://github.com/SamuNatsu/live2d-widget-enhanced")}))}({resource:"https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest",api:new class{constructor(t){this.cdnUrl=t}loadModelList(){return t(this,void 0,void 0,(function*(){if(void 0===this.modelList){const t=yield fetch(`${this.cdnUrl}/model_list.json`);this.modelList=yield t.json()}}))}get(e,i){return t(this,void 0,void 0,(function*(){yield this.loadModelList();const t=this.modelList.models[e]instanceof Array?this.modelList.models[e][i]:this.modelList.models[e];return`${this.cdnUrl}/model/${t}/index.json`}))}rand(e){return t(this,void 0,void 0,(function*(){yield this.loadModelList();const t=i(0,this.modelList.models.length,e);return{model:{id:t,message:this.modelList.messages[t]}}}))}switch(e){return t(this,void 0,void 0,(function*(){yield this.loadModelList();const t=(e+1)%this.modelList.models.length;return{model:{id:t,message:this.modelList.messages[t]}}}))}randTexture(e,o){return t(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[e]instanceof Array?i(0,this.modelList.models[e].length,o):0}}}))}switchTexture(e,i){return t(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[e]instanceof Array?(i+1)%this.modelList.models[e].length:0}}}))}}("https://fastly.jsdelivr.net/gh/fghrsh/live2d_api"),tips:"https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu-tips.json"})}();
