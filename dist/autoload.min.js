/*! Live2D Widget Enhanced (https://github.com/SamuNatsu/live2d-widget-enhanced) */
!function(){"use strict";function e(e,t,o,n){return new(o||(o=Promise))((function(s,i){function l(e){try{r(n.next(e))}catch(e){i(e)}}function c(e){try{r(n.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,c)}r((n=n.apply(e,t||[])).next())}))}function t(e){console.log(`%cLive2D%c ${e}`,"background:#389ad5;padding:1px 5px;border-radius:3px;color:#fff","")}function o(e){return e[Math.floor(Math.random()*e.length)]}function n(e,t,o){if(e=Math.floor(e),t=Math.floor(t),o=Math.floor(o),t-e==1&&o===e)return o;for(;;){const n=Math.floor(Math.random()*(t-e))+e;if(n!==o)return n}}var s;function i(t,o){return e(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{switch(o){case s.Script:{const o=document.createElement("script");o.src=t,o.onload=()=>e(),o.onerror=()=>n(),document.head.appendChild(o);break}case s.Style:{const o=document.createElement("link");o.rel="stylesheet",o.href=t,o.onload=()=>e(),o.onerror=()=>n(),document.head.append(o);break}}}))}))}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.Script=0]="Script",e[e.Style=1]="Style"}(s||(s={}));let l=null;function c(e,t,n){var s;if(parseInt(null!==(s=sessionStorage.getItem("waifu-text"))&&void 0!==s?s:Number.MIN_SAFE_INTEGER.toString())>n)return;null!==l&&(clearTimeout(l),l=null);const i=e instanceof Array?o(e):e;sessionStorage.setItem("waifu-text",n.toString());const c=document.querySelector("#waifu-tips");c.innerHTML=i,c.classList.add("waifu-tips-active"),l=setTimeout((()=>{sessionStorage.removeItem("waifu-text"),c.classList.remove("waifu-tips-active")}),t)}class r{constructor(e){this.api=e}loadModel(o,n,s){return e(this,void 0,void 0,(function*(){localStorage.setItem("modelId",o.toString()),localStorage.setItem("modelTexturesId",n.toString()),void 0!==s&&c(s,4e3,10),loadlive2d("live2d",yield this.api.get(o,n)),t(`模型 ${o}-${n} 加载完成`)}))}loadRandModel(){return e(this,void 0,void 0,(function*(){var e;const t=parseInt(null!==(e=localStorage.getItem("modelId"))&&void 0!==e?e:"1"),o=yield this.api.rand(t);yield this.loadModel(o.model.id,0,o.model.message)}))}loadNextModel(){return e(this,void 0,void 0,(function*(){var e;const t=parseInt(null!==(e=localStorage.getItem("modelId"))&&void 0!==e?e:"1"),o=yield this.api.switch(t);yield this.loadModel(o.model.id,0,o.model.message)}))}loadRandTexture(){return e(this,void 0,void 0,(function*(){var e,t;const o=parseInt(null!==(e=localStorage.getItem("modelId"))&&void 0!==e?e:"1"),n=parseInt(null!==(t=localStorage.getItem("modelTexturesId"))&&void 0!==t?t:"0"),s=yield this.api.randTexture(o,n);yield this.loadModel(o,s.textures.id,1!==s.textures.id||1!==o&&0!==n?"我的新衣服好看嘛？":"我还没有其他衣服呢！")}))}loadNextTexture(){return e(this,void 0,void 0,(function*(){var e,t;const o=parseInt(null!==(e=localStorage.getItem("modelId"))&&void 0!==e?e:"1"),n=parseInt(null!==(t=localStorage.getItem("modelTexturesId"))&&void 0!==t?t:"0"),s=yield this.api.switchTexture(o,n);yield this.loadModel(o,s.textures.id,0===s.textures.id&&0===n?"我还没有其他衣服呢！":"我的新衣服好看嘛？")}))}}const a={hitokoto:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z"/></svg>',callback:function(){fetch("https://v1.hitokoto.cn").then((e=>e.json())).then((e=>{const t=`这句一言来自 <span>「${e.from}」</span>，是 <span>${e.creator}</span> 在 hitokoto.cn 投稿的。`;c(e.hitokoto,6e3,9),setTimeout((()=>{c(t,4e3,9)}),6e3)}))}},"switch-model":{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M399 384.2C376.9 345.8 335.4 320 288 320H224c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"/></svg>',callback:()=>{}},"switch-texture":{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M320 64A64 64 0 1 0 192 64a64 64 0 1 0 128 0zm-96 96c-35.3 0-64 28.7-64 64v48c0 17.7 14.3 32 32 32h1.8l11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5h38.7c16.3 0 30-12.3 31.8-28.5L318.2 304H320c17.7 0 32-14.3 32-32V224c0-35.3-28.7-64-64-64H224zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z"/></svg>',callback:()=>{}},photo:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z"/></svg>',callback:()=>{c("照好了嘛，是不是很可爱呢？",6e3,9),Live2D.captureName="photo.png",Live2D.captureFrame=!0}},info:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>',callback:()=>{open("https://github.com/SamuNatsu/live2d-widget-enhanced")}},quit:{icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>',callback:()=>{localStorage.setItem("waifu-display",Date.now().toString()),c("愿你有一天能与重要的人重逢。",2e3,11);const e=document.querySelector("#waifu"),t=document.querySelector("#waifu-toggle");e.style.border="-500px",setTimeout((()=>{e.style.display="none",t.classList.add("waifu-toggle-active")}),3e3)}}};function d(e){var t,o,n,s,i,l;const c=new r(e.api);localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",'<div id="waifu"><div id="waifu-tips"></div><canvas id="live2d" width="800" height="800"></canvas><div id="waifu-tool"></div></div>'),setTimeout((()=>{document.querySelector("#waifu").style.bottom="0"}),0),void 0===e.tools&&(e.tools=a),e.tools["switch-model"].callback=()=>c.loadNextModel(),e.tools["switch-texture"].callback=()=>c.loadNextTexture();for(const t of Object.keys(e.tools)){const{icon:o,callback:n}=e.tools[t];document.querySelector("#waifu-tool").insertAdjacentHTML("beforeend",`<span id="waifu-tool-${t}">${o}</span>`),document.querySelector(`#waifu-tool-${t}`).addEventListener("click",(()=>n()))}const d=parseInt(null!==(n=null!==(t=localStorage.getItem("modelId"))&&void 0!==t?t:null===(o=e.defaultModel)||void 0===o?void 0:o.toString())&&void 0!==n?n:"0"),m=parseInt(null!==(l=null!==(s=localStorage.getItem("modelTexturesId"))&&void 0!==s?s:null===(i=e.defaultTexture)||void 0===i?void 0:i.toString())&&void 0!==l?l:"0");c.loadModel(d,m),"object"==typeof e.tips?u(e,e.tips):fetch(e.tips).then((e=>e.json())).then((t=>u(e,t)))}function u(e,t){let n,s=!1,i=null,l=t.message.default;window.addEventListener("mousemove",(()=>{s=!0})),window.addEventListener("keydown",(()=>{s=!0})),setInterval((()=>{s?(s=!1,clearInterval(i),i=null):null===i&&(i=setInterval((()=>{c(l,6e3,9)}),2e4))})),window.addEventListener("mouseover",(e=>{const s=e.target;for(const{selector:e,text:i}of t.mouseover){if(null===s.closest(e))continue;if(n===e)return;n=e;let t=o(i);return t=t.replace("{text}",s.innerText),void c(t,4e3,8)}})),window.addEventListener("click",(e=>{const n=e.target;for(const{selector:e,text:s}of t.click){if(null===n.closest(e))continue;let t=o(s);return t=t.replace("{text}",n.innerText),void c(t,4e3,8)}}));const r=()=>{};console.log("%c",r),r.toString=()=>(c(t.message.console,6e3,9),""),window.addEventListener("copy",(()=>{c(t.message.copy,6e3,9)})),window.addEventListener("visibilitychange",(()=>{c(t.message.visibilitychange,6e3,9)})),c(function(e,t){var o,n;if("/"===location.pathname)for(let{hour:e,text:n}of t){const t=new Date,s=parseInt(e.split("-")[0]),i=parseInt(null!==(o=e.split("-")[1])&&void 0!==o?o:s);if(s<=t.getHours()&&t.getHours()<=i)return n}const s=`欢迎阅读<span>「${document.title.split(null!==(n=e.titleSeparator)&&void 0!==n?n:" - ")[0]}」</span>`;if(""!==document.referrer){const e=new URL(document.referrer),t=e.hostname.split(".")[1],o={baidu:"百度",bing:"必应",google:"谷歌",so:"360 搜索",sogou:"搜狗"};return location.hostname===e.hostname?s:t in o?`Hello！来自 <span>${o[t]}</span> 的朋友<br>${s}`:`Hello！来自 <span>${e.hostname}</span> 的朋友<br>${s}`}return s}(e,t.time),7e3,11),t.seasons.forEach((({date:e,text:t})=>{var n;const s=new Date,i=e.split("-")[0],c=null!==(n=e.split("-")[1])&&void 0!==n?n:i;if(parseInt(i.split("/")[0])<=s.getMonth()+1&&s.getMonth()+1<=parseInt(c.split("/")[0])&&parseInt(i.split("/")[1])<=s.getDate()&&s.getDate()<=parseInt(c.split("/")[1])){let e=o(t);e=e.replace("{year}",s.getFullYear().toString()),l.push(e)}}))}!function(o){e(this,void 0,void 0,(function*(){var e;console.log("\n    く__,.ヘヽ.        /  ,ー､ 〉\n              ＼ ', !-─‐-i  /  /´\n              ／｀ｰ'       L/／｀ヽ､\n            /   ／,   /|   ,   ,       ',\n          ｲ   / /-‐/  ｉ  L_ ﾊ ヽ!   i\n          ﾚ ﾍ 7ｲ｀ﾄ   ﾚ'ｧ-ﾄ､!ハ|   |\n            !,/7 '0'     ´0iソ|    |\n            |.从\"    _     ,,,, / |./    |\n            ﾚ'| i＞.､,,__  _,.イ /   .i   |\n              ﾚ'| | / k_７_/ﾚ'ヽ,  ﾊ.  |\n                | |/i 〈|/   i  ,.ﾍ |  i  |\n                .|/ /  ｉ：    ﾍ!    ＼  |\n                kヽ>､ﾊ    _,.ﾍ､    /､!\n                !'〈//｀Ｔ´', ＼ ｀'7'ｰr'\n                ﾚ'ヽL__|___i,___,ンﾚ|ノ\n                    ﾄ-,/  |___./\n                    'ｰ'    !_,.:\n    加强版 Live2D 看板娘组件 | Live2D Widget Enhanced"),t("Version: 0.1.0"),t("Github: https://github.com/SamuNatsu/live2d-widget-enhanced");const n=(()=>{if(void 0!==o.resource)return o.resource;const e=document.currentScript.src;return e.substring(0,e.lastIndexOf("/"))})();yield Promise.all([i(n+"/live2d.min.js",s.Script),i(n+"/waifu.css",s.Style)]),document.body.insertAdjacentHTML("beforeend",'<div id="waifu-toggle"><span>看板娘</span></div>');const l=document.querySelector("#waifu-toggle");l.addEventListener("click",(()=>{if(l.classList.remove("waifu-toggle-active"),l.getAttribute("first-time"))d(o),l.removeAttribute("first-time");else{localStorage.removeItem("waifu-display");const e=document.querySelector("#waifu");e.style.display="",setTimeout((()=>{e.style.bottom="0"}),0)}}));const c=parseInt(null!==(e=localStorage.getItem("waifu-display"))&&void 0!==e?e:"0");Date.now()-c<864e5?(l.setAttribute("first-time",""),setTimeout((()=>{l.classList.add("waifu-toggle-active")}))):d(o)}))}({resource:"https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest",api:new class{constructor(e){this.cdnUrl=e}loadModelList(){return e(this,void 0,void 0,(function*(){if(void 0===this.modelList){const e=yield fetch(`${this.cdnUrl}/model_list.json`);this.modelList=yield e.json()}}))}get(t,o){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=this.modelList.models[t]instanceof Array?this.modelList.models[t][o]:this.modelList.models[t];return`${this.cdnUrl}/model/${e}/index.json`}))}rand(t){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=n(0,this.modelList.models.length,t);return{model:{id:e,message:this.modelList.messages[e]}}}))}switch(t){return e(this,void 0,void 0,(function*(){yield this.loadModelList();const e=(t+1)%this.modelList.models.length;return{model:{id:e,message:this.modelList.messages[e]}}}))}randTexture(t,o){return e(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[t]instanceof Array?n(0,this.modelList.models[t].length,o):0}}}))}switchTexture(t,o){return e(this,void 0,void 0,(function*(){return yield this.loadModelList(),{textures:{id:this.modelList.models[t]instanceof Array?(o+1)%this.modelList.models[t].length:0}}}))}}("https://fastly.jsdelivr.net/gh/fghrsh/live2d_api"),tips:"https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu-tips.json"})}();
